# Docker Compose 버전 지정
version: '3.8'

# 개발환경용 서비스들 정의
services:
  # 개발용 PostgreSQL 데이터베이스 (프로덕션과 분리)
  postgres-dev:
    # PostgreSQL 15 Alpine 이미지 사용
    image: postgres:15-alpine
    # 개발용임을 명시하는 컨테이너 이름
    container_name: reservation-postgres-dev
    restart: unless-stopped
    environment:
      # 개발용 데이터베이스 이름 (기본값: reservation_dev)
      POSTGRES_DB: ${DB_DATABASE:-reservation_dev}
      # 개발용 데이터베이스 사용자 이름
      POSTGRES_USER: ${DB_USERNAME:-reservation_user}
      # 개발용 데이터베이스 비밀번호
      POSTGRES_PASSWORD: ${DB_PASSWORD:-reservation_password}
    ports:
      # 프로덕션과 포트 충돌을 피하기 위해 5433 포트 사용
      - "${DB_PORT:-5433}:5432"
    volumes:
      # 개발용 데이터를 별도 볼륨에 저장 (프로덕션 데이터와 분리)
      - postgres_dev_data:/var/lib/postgresql/data
    networks:
      # 개발용 전용 네트워크 사용
      - reservation-dev-network

  # 개발용 Redis 서비스
  redis-dev:
    image: redis:7-alpine
    container_name: reservation-redis-dev
    restart: unless-stopped
    ports:
      # 프로덕션 Redis와 포트 충돌 방지를 위해 6380 포트 사용
      - "${REDIS_PORT:-6380}:6379"
    volumes:
      # 개발용 Redis 데이터 저장
      - redis_dev_data:/data
    networks:
      - reservation-dev-network

  # PgAdmin - PostgreSQL 데이터베이스 관리 도구
  pgadmin:
    # 공식 PgAdmin4 이미지 사용
    image: dpage/pgadmin4:latest
    container_name: reservation-pgadmin
    restart: unless-stopped
    environment:
      # PgAdmin 로그인용 이메일 (관리자 계정)
      PGADMIN_DEFAULT_EMAIL: admin@example.com
      # PgAdmin 로그인용 비밀번호
      PGADMIN_DEFAULT_PASSWORD: admin123
    ports:
      # 웹 브라우저에서 http://localhost:5050 으로 접속 가능
      - "5050:80"
    volumes:
      # PgAdmin 설정과 데이터를 영구 저장
      - pgadmin_data:/var/lib/pgadmin
    # PostgreSQL이 실행된 후에 시작
    depends_on:
      - postgres-dev
    networks:
      - reservation-dev-network

  # Redis Commander - Redis 데이터베이스 관리 도구
  redis-commander:
    # 공식 Redis Commander 이미지 사용
    image: rediscommander/redis-commander:latest
    container_name: reservation-redis-commander
    restart: unless-stopped
    environment:
      # Redis 연결 설정: 이름:호스트:포트 형식
      # 'local'은 Redis Commander에서 보여질 연결 이름
      REDIS_HOSTS: local:redis-dev:6379
    ports:
      # 웹 브라우저에서 http://localhost:8081 으로 접속 가능
      - "8081:8081"
    # Redis가 실행된 후에 시작
    depends_on:
      - redis-dev
    networks:
      - reservation-dev-network

# 개발환경용 볼륨들 정의 (데이터 영구 저장)
volumes:
  # 개발용 PostgreSQL 데이터 저장 볼륨
  postgres_dev_data:
    driver: local
  # 개발용 Redis 데이터 저장 볼륨
  redis_dev_data:
    driver: local
  # PgAdmin 설정 데이터 저장 볼륨
  pgadmin_data:
    driver: local

# 개발환경 전용 네트워크 정의
networks:
  # 개발환경의 모든 컨테이너들이 사용할 네트워크
  # 프로덕션 네트워크와 완전히 분리됨
  reservation-dev-network:
    driver: bridge
